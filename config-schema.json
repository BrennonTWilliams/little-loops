{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "little-loops://config-schema.json",
  "title": "little-loops Configuration",
  "description": "Configuration schema for little-loops development workflow plugin",
  "type": "object",
  "properties": {
    "$schema": {
      "type": "string",
      "description": "JSON Schema reference"
    },
    "project": {
      "type": "object",
      "description": "Project-specific settings",
      "properties": {
        "name": {
          "type": "string",
          "description": "Project name (defaults to directory name)"
        },
        "src_dir": {
          "type": "string",
          "description": "Source code directory",
          "default": "src/"
        },
        "test_dir": {
          "type": "string",
          "description": "Test directory",
          "default": "tests"
        },
        "test_cmd": {
          "type": "string",
          "description": "Command to run tests",
          "default": "pytest"
        },
        "lint_cmd": {
          "type": "string",
          "description": "Command to run linter",
          "default": "ruff check ."
        },
        "type_cmd": {
          "type": ["string", "null"],
          "description": "Command to run type checker",
          "default": "mypy"
        },
        "format_cmd": {
          "type": ["string", "null"],
          "description": "Command to format code",
          "default": "ruff format ."
        },
        "build_cmd": {
          "type": ["string", "null"],
          "description": "Command to build project",
          "default": null
        }
      },
      "additionalProperties": false
    },
    "issues": {
      "type": "object",
      "description": "Issue management settings",
      "properties": {
        "base_dir": {
          "type": "string",
          "description": "Base directory for issues",
          "default": ".issues"
        },
        "categories": {
          "type": "object",
          "description": "Issue category definitions",
          "additionalProperties": {
            "type": "object",
            "properties": {
              "prefix": {
                "type": "string",
                "description": "Issue ID prefix (e.g., BUG, FEAT)"
              },
              "dir": {
                "type": "string",
                "description": "Directory name (defaults to category key)"
              },
              "action": {
                "type": "string",
                "description": "Default action verb (e.g., fix, implement)"
              }
            },
            "required": ["prefix"]
          },
          "default": {
            "bugs": {"prefix": "BUG", "dir": "bugs", "action": "fix"},
            "features": {"prefix": "FEAT", "dir": "features", "action": "implement"},
            "enhancements": {"prefix": "ENH", "dir": "enhancements", "action": "improve"}
          }
        },
        "completed_dir": {
          "type": "string",
          "description": "Directory for completed issues",
          "default": "completed"
        },
        "priorities": {
          "type": "array",
          "description": "Valid priority prefixes in order",
          "items": {"type": "string"},
          "default": ["P0", "P1", "P2", "P3", "P4", "P5"]
        },
        "templates_dir": {
          "type": ["string", "null"],
          "description": "Directory for issue templates",
          "default": null
        }
      },
      "additionalProperties": false
    },
    "automation": {
      "type": "object",
      "description": "Sequential automation script settings (ll-auto)",
      "properties": {
        "timeout_seconds": {
          "type": "integer",
          "description": "Timeout per issue in seconds",
          "default": 3600,
          "minimum": 60
        },
        "state_file": {
          "type": "string",
          "description": "State file for resume capability",
          "default": ".auto-manage-state.json"
        },
        "worktree_base": {
          "type": "string",
          "description": "Base directory for git worktrees",
          "default": ".worktrees"
        },
        "max_workers": {
          "type": "integer",
          "description": "Maximum parallel workers",
          "default": 2,
          "minimum": 1,
          "maximum": 8
        },
        "stream_output": {
          "type": "boolean",
          "description": "Stream subprocess output to console",
          "default": true
        }
      },
      "additionalProperties": false
    },
    "parallel": {
      "type": "object",
      "description": "Parallel automation settings with git worktree isolation (ll-parallel)",
      "properties": {
        "max_workers": {
          "type": "integer",
          "description": "Number of parallel workers",
          "default": 2,
          "minimum": 1,
          "maximum": 8
        },
        "p0_sequential": {
          "type": "boolean",
          "description": "Process P0 issues sequentially (not in parallel)",
          "default": true
        },
        "worktree_base": {
          "type": "string",
          "description": "Base directory for git worktrees",
          "default": ".worktrees"
        },
        "state_file": {
          "type": "string",
          "description": "State file for parallel processing resume",
          "default": ".parallel-manage-state.json"
        },
        "timeout_per_issue": {
          "type": "integer",
          "description": "Timeout per issue in seconds",
          "default": 3600,
          "minimum": 60
        },
        "max_merge_retries": {
          "type": "integer",
          "description": "Maximum rebase attempts before failing merge",
          "default": 2,
          "minimum": 0,
          "maximum": 5
        },
        "stream_subprocess_output": {
          "type": "boolean",
          "description": "Stream Claude CLI output to console",
          "default": false
        },
        "command_prefix": {
          "type": "string",
          "description": "Prefix for slash commands (e.g., /ll:, /cl:)",
          "default": "/ll:"
        },
        "ready_command": {
          "type": "string",
          "description": "Template for ready_issue command (supports {{issue_id}})",
          "default": "ready_issue {{issue_id}}"
        },
        "manage_command": {
          "type": "string",
          "description": "Template for manage_issue command (supports {{issue_type}}, {{action}}, {{issue_id}})",
          "default": "manage_issue {{issue_type}} {{action}} {{issue_id}}"
        },
        "worktree_copy_files": {
          "type": "array",
          "description": "Files to copy from main repo to worktrees (relative paths)",
          "items": {
            "type": "string"
          },
          "default": [".claude/settings.local.json", ".env"]
        }
      },
      "additionalProperties": false
    },
    "commands": {
      "type": "object",
      "description": "Command customization",
      "properties": {
        "pre_implement": {
          "type": ["string", "null"],
          "description": "Command to run before implementation"
        },
        "post_implement": {
          "type": ["string", "null"],
          "description": "Command to run after implementation"
        },
        "custom_verification": {
          "type": "array",
          "description": "Additional verification commands",
          "items": {"type": "string"},
          "default": []
        }
      },
      "additionalProperties": false
    },
    "scan": {
      "type": "object",
      "description": "Codebase scanning settings",
      "properties": {
        "focus_dirs": {
          "type": "array",
          "description": "Directories to focus on during scans",
          "items": {"type": "string"},
          "default": ["src/", "tests/"]
        },
        "exclude_patterns": {
          "type": "array",
          "description": "Glob patterns to exclude from scans",
          "items": {"type": "string"},
          "default": ["**/node_modules/**", "**/__pycache__/**", "**/.git/**"]
        },
        "custom_agents": {
          "type": "array",
          "description": "Custom scanning agents to include",
          "items": {"type": "string"},
          "default": []
        }
      },
      "additionalProperties": false
    },
    "workflow": {
      "type": "object",
      "description": "Workflow behavior settings for manage_issue and ready_issue commands",
      "properties": {
        "phase_gates": {
          "type": "object",
          "description": "Phase gate settings for human verification between implementation phases",
          "properties": {
            "enabled": {
              "type": "boolean",
              "description": "Enable phase gates for manual verification",
              "default": true
            },
            "auto_mode_skip": {
              "type": "boolean",
              "description": "Skip phase gates when --auto flag is used",
              "default": true
            }
          },
          "additionalProperties": false
        },
        "deep_research": {
          "type": "object",
          "description": "Deep research settings using sub-agents before planning",
          "properties": {
            "enabled": {
              "type": "boolean",
              "description": "Enable deep research by default",
              "default": true
            },
            "quick_flag_skips": {
              "type": "boolean",
              "description": "Allow --quick flag to skip research",
              "default": true
            },
            "agents": {
              "type": "array",
              "description": "Sub-agents to spawn for research",
              "items": {"type": "string"},
              "default": ["codebase-locator", "codebase-analyzer", "codebase-pattern-finder"]
            }
          },
          "additionalProperties": false
        },
        "plan_template": {
          "type": "object",
          "description": "Plan template settings",
          "properties": {
            "sections_recommended": {
              "type": "boolean",
              "description": "Show all template sections as recommended",
              "default": true
            },
            "sections_mandatory": {
              "type": "boolean",
              "description": "Require all template sections (if false, sections can be skipped)",
              "default": false
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "prompt_optimization": {
      "type": "object",
      "description": "Automatic prompt optimization settings (toggle with /ll:toggle_autoprompt)",
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Enable automatic prompt optimization",
          "default": true
        },
        "mode": {
          "type": "string",
          "enum": ["quick", "thorough"],
          "description": "Optimization mode (quick uses config only, thorough spawns agent)",
          "default": "quick"
        },
        "confirm": {
          "type": "boolean",
          "description": "Show diff and ask for confirmation before applying",
          "default": true
        },
        "bypass_prefix": {
          "type": "string",
          "description": "Prefix to bypass optimization (e.g., * to skip)",
          "default": "*"
        },
        "clarity_threshold": {
          "type": "integer",
          "description": "Minimum clarity score (1-10) to pass through unchanged",
          "default": 6,
          "minimum": 1,
          "maximum": 10
        }
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": false
}
