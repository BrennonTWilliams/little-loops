{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "little-loops://config-schema.json",
  "title": "little-loops Configuration",
  "description": "Configuration schema for little-loops development workflow plugin",
  "type": "object",
  "properties": {
    "$schema": {
      "type": "string",
      "description": "JSON Schema reference"
    },
    "project": {
      "type": "object",
      "description": "Project-specific settings",
      "properties": {
        "name": {
          "type": "string",
          "description": "Project name (defaults to directory name)"
        },
        "src_dir": {
          "type": "string",
          "description": "Source code directory",
          "default": "src/"
        },
        "test_dir": {
          "type": "string",
          "description": "Test directory",
          "default": "tests"
        },
        "test_cmd": {
          "type": "string",
          "description": "Command to run tests",
          "default": "pytest"
        },
        "lint_cmd": {
          "type": "string",
          "description": "Command to run linter",
          "default": "ruff check ."
        },
        "type_cmd": {
          "type": ["string", "null"],
          "description": "Command to run type checker",
          "default": "mypy"
        },
        "format_cmd": {
          "type": ["string", "null"],
          "description": "Command to format code",
          "default": "ruff format ."
        },
        "build_cmd": {
          "type": ["string", "null"],
          "description": "Command to build project",
          "default": null
        },
        "run_cmd": {
          "type": ["string", "null"],
          "description": "Command to run/start project (smoke test)",
          "default": null
        }
      },
      "additionalProperties": false
    },
    "issues": {
      "type": "object",
      "description": "Issue management settings",
      "properties": {
        "base_dir": {
          "type": "string",
          "description": "Base directory for issues",
          "default": ".issues"
        },
        "categories": {
          "type": "object",
          "description": "Issue category definitions. Required categories (bugs, features, enhancements) are automatically included if not specified. Custom categories are merged with required ones.",
          "additionalProperties": {
            "type": "object",
            "properties": {
              "prefix": {
                "type": "string",
                "description": "Issue ID prefix (e.g., BUG, FEAT)"
              },
              "dir": {
                "type": "string",
                "description": "Directory name (defaults to category key)"
              },
              "action": {
                "type": "string",
                "description": "Default action verb (e.g., fix, implement)"
              }
            },
            "required": ["prefix"]
          },
          "default": {
            "bugs": {"prefix": "BUG", "dir": "bugs", "action": "fix"},
            "features": {"prefix": "FEAT", "dir": "features", "action": "implement"},
            "enhancements": {"prefix": "ENH", "dir": "enhancements", "action": "improve"}
          }
        },
        "completed_dir": {
          "type": "string",
          "description": "Directory for completed issues",
          "default": "completed"
        },
        "priorities": {
          "type": "array",
          "description": "Valid priority prefixes in order",
          "items": {"type": "string"},
          "default": ["P0", "P1", "P2", "P3", "P4", "P5"]
        },
        "templates_dir": {
          "type": ["string", "null"],
          "description": "Directory for issue templates",
          "default": null
        },
        "capture_template": {
          "type": "string",
          "enum": ["full", "minimal"],
          "description": "Default template style for captured issues (full includes all sections, minimal includes only Summary, Context, and footer)",
          "default": "full"
        },
        "duplicate_detection": {
          "type": "object",
          "description": "Duplicate detection settings for issue capture",
          "properties": {
            "exact_threshold": {
              "type": "number",
              "description": "Jaccard similarity threshold for exact duplicates",
              "default": 0.8,
              "minimum": 0.5,
              "maximum": 1.0
            },
            "similar_threshold": {
              "type": "number",
              "description": "Jaccard similarity threshold for similar issues",
              "default": 0.5,
              "minimum": 0.1,
              "maximum": 0.9
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "automation": {
      "type": "object",
      "description": "Sequential automation script settings (ll-auto)",
      "properties": {
        "timeout_seconds": {
          "type": "integer",
          "description": "Timeout per issue in seconds",
          "default": 3600,
          "minimum": 60
        },
        "state_file": {
          "type": "string",
          "description": "State file for resume capability",
          "default": ".auto-manage-state.json"
        },
        "worktree_base": {
          "type": "string",
          "description": "Base directory for git worktrees",
          "default": ".worktrees"
        },
        "max_workers": {
          "type": "integer",
          "description": "Maximum parallel workers",
          "default": 2,
          "minimum": 1,
          "maximum": 8
        },
        "stream_output": {
          "type": "boolean",
          "description": "Stream subprocess output to console",
          "default": true
        }
      },
      "additionalProperties": false
    },
    "parallel": {
      "type": "object",
      "description": "Parallel automation settings with git worktree isolation (ll-parallel)",
      "properties": {
        "max_workers": {
          "type": "integer",
          "description": "Number of parallel workers",
          "default": 2,
          "minimum": 1,
          "maximum": 8
        },
        "p0_sequential": {
          "type": "boolean",
          "description": "Process P0 issues sequentially (not in parallel)",
          "default": true
        },
        "worktree_base": {
          "type": "string",
          "description": "Base directory for git worktrees",
          "default": ".worktrees"
        },
        "state_file": {
          "type": "string",
          "description": "State file for parallel processing resume",
          "default": ".parallel-manage-state.json"
        },
        "timeout_per_issue": {
          "type": "integer",
          "description": "Timeout per issue in seconds",
          "default": 3600,
          "minimum": 60
        },
        "max_merge_retries": {
          "type": "integer",
          "description": "Maximum rebase attempts before failing merge",
          "default": 2,
          "minimum": 0,
          "maximum": 5
        },
        "stream_subprocess_output": {
          "type": "boolean",
          "description": "Stream Claude CLI output to console",
          "default": false
        },
        "command_prefix": {
          "type": "string",
          "description": "Prefix for slash commands (e.g., /ll:, /cl:)",
          "default": "/ll:"
        },
        "ready_command": {
          "type": "string",
          "description": "Template for ready_issue command (supports {{issue_id}})",
          "default": "ready_issue {{issue_id}}"
        },
        "manage_command": {
          "type": "string",
          "description": "Template for manage_issue command (supports {{issue_type}}, {{action}}, {{issue_id}})",
          "default": "manage_issue {{issue_type}} {{action}} {{issue_id}}"
        },
        "worktree_copy_files": {
          "type": "array",
          "description": "Additional files to copy from main repo to worktrees (relative paths). Note: .claude/ directory is always copied automatically.",
          "items": {
            "type": "string"
          },
          "default": [".env"]
        }
      },
      "additionalProperties": false
    },
    "commands": {
      "type": "object",
      "description": "Command customization",
      "properties": {
        "pre_implement": {
          "type": ["string", "null"],
          "description": "Command to run before implementation"
        },
        "post_implement": {
          "type": ["string", "null"],
          "description": "Command to run after implementation"
        },
        "custom_verification": {
          "type": "array",
          "description": "Additional verification commands",
          "items": {"type": "string"},
          "default": []
        }
      },
      "additionalProperties": false
    },
    "scan": {
      "type": "object",
      "description": "Codebase scanning settings",
      "properties": {
        "focus_dirs": {
          "type": "array",
          "description": "Directories to focus on during scans",
          "items": {"type": "string"},
          "default": ["src/", "tests/"]
        },
        "exclude_patterns": {
          "type": "array",
          "description": "Glob patterns to exclude from scans",
          "items": {"type": "string"},
          "default": ["**/node_modules/**", "**/__pycache__/**", "**/.git/**"]
        },
        "custom_agents": {
          "type": "array",
          "description": "Custom scanning agents to include",
          "items": {"type": "string"},
          "default": []
        }
      },
      "additionalProperties": false
    },
    "workflow": {
      "type": "object",
      "description": "Workflow behavior settings for manage_issue and ready_issue commands",
      "properties": {
        "phase_gates": {
          "type": "object",
          "description": "Phase gate settings for human verification between implementation phases",
          "properties": {
            "enabled": {
              "type": "boolean",
              "description": "Enable phase gates for manual verification",
              "default": true
            },
            "auto_mode_skip": {
              "type": "boolean",
              "description": "Skip phase gates when --auto flag is used",
              "default": true
            }
          },
          "additionalProperties": false
        },
        "deep_research": {
          "type": "object",
          "description": "Deep research settings using sub-agents before planning",
          "properties": {
            "enabled": {
              "type": "boolean",
              "description": "Enable deep research by default",
              "default": true
            },
            "quick_flag_skips": {
              "type": "boolean",
              "description": "Allow --quick flag to skip research",
              "default": true
            },
            "agents": {
              "type": "array",
              "description": "Sub-agents to spawn for research",
              "items": {"type": "string"},
              "default": ["codebase-locator", "codebase-analyzer", "codebase-pattern-finder"]
            }
          },
          "additionalProperties": false
        },
        "plan_template": {
          "type": "object",
          "description": "Plan template settings",
          "properties": {
            "sections_recommended": {
              "type": "boolean",
              "description": "Show all template sections as recommended",
              "default": true
            },
            "sections_mandatory": {
              "type": "boolean",
              "description": "Require all template sections (if false, sections can be skipped)",
              "default": false
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "prompt_optimization": {
      "type": "object",
      "description": "Automatic prompt optimization settings (toggle with /ll:toggle_autoprompt)",
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Enable automatic prompt optimization",
          "default": true
        },
        "mode": {
          "type": "string",
          "enum": ["quick", "thorough"],
          "description": "Optimization mode (quick uses config only, thorough spawns agent)",
          "default": "quick"
        },
        "confirm": {
          "type": "boolean",
          "description": "Show diff and ask for confirmation before applying",
          "default": true
        },
        "bypass_prefix": {
          "type": "string",
          "description": "Prefix to bypass optimization (e.g., * to skip)",
          "default": "*"
        },
        "clarity_threshold": {
          "type": "integer",
          "description": "Minimum clarity score (1-10) to pass through unchanged",
          "default": 6,
          "minimum": 1,
          "maximum": 10
        }
      },
      "additionalProperties": false
    },
    "continuation": {
      "type": "object",
      "description": "Session continuation and handoff settings (commands: /ll:handoff, /ll:resume)",
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Enable continuation prompt features",
          "default": true
        },
        "auto_detect_on_session_start": {
          "type": "boolean",
          "description": "Check for continuation prompt when session starts",
          "default": true
        },
        "include_todos": {
          "type": "boolean",
          "description": "Include todo list state in continuation prompt",
          "default": true
        },
        "include_git_status": {
          "type": "boolean",
          "description": "Include git status in continuation prompt",
          "default": true
        },
        "include_recent_files": {
          "type": "boolean",
          "description": "Include recently modified files in continuation prompt",
          "default": true
        },
        "max_continuations": {
          "type": "integer",
          "description": "Maximum automatic session continuations for CLI tools",
          "default": 3,
          "minimum": 1,
          "maximum": 10
        },
        "prompt_expiry_hours": {
          "type": "integer",
          "description": "Hours before continuation prompt is considered stale",
          "default": 24,
          "minimum": 1,
          "maximum": 168
        }
      },
      "additionalProperties": false
    },
    "context_monitor": {
      "type": "object",
      "description": "Proactive context monitoring with automatic handoff before hitting limits (disabled by default)",
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Enable proactive context monitoring with auto-handoff",
          "default": false
        },
        "auto_handoff_threshold": {
          "type": "integer",
          "description": "Estimated context usage percentage to trigger automatic handoff (0-100)",
          "default": 80,
          "minimum": 50,
          "maximum": 95
        },
        "estimate_weights": {
          "type": "object",
          "description": "Weight factors for context estimation heuristics",
          "properties": {
            "read_per_line": {
              "type": "number",
              "description": "Estimated tokens per line read",
              "default": 10
            },
            "tool_call_base": {
              "type": "integer",
              "description": "Base tokens per tool call overhead",
              "default": 100
            },
            "bash_output_per_char": {
              "type": "number",
              "description": "Estimated tokens per character of bash output",
              "default": 0.3
            }
          },
          "additionalProperties": false
        },
        "context_limit_estimate": {
          "type": "integer",
          "description": "Estimated total context window tokens (conservative)",
          "default": 150000,
          "minimum": 50000,
          "maximum": 500000
        },
        "state_file": {
          "type": "string",
          "description": "File to track context usage state",
          "default": ".claude/ll-context-state.json"
        }
      },
      "additionalProperties": false
    },
    "documents": {
      "type": "object",
      "description": "Key document tracking by category for issue alignment validation",
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Enable document category tracking",
          "default": false
        },
        "categories": {
          "type": "object",
          "description": "Document categories with file lists",
          "additionalProperties": {
            "type": "object",
            "properties": {
              "description": {
                "type": "string",
                "description": "What this category covers"
              },
              "files": {
                "type": "array",
                "items": {"type": "string"},
                "description": "Relative paths to key documents"
              }
            },
            "required": ["files"]
          },
          "default": {}
        }
      },
      "additionalProperties": false
    },
    "product": {
      "type": "object",
      "description": "Product/business analysis configuration (opt-in feature, disabled by default)",
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Enable product-focused issue analysis",
          "default": false
        },
        "goals_file": {
          "type": "string",
          "description": "Path to product goals/vision document",
          "default": ".claude/ll-goals.md"
        },
        "analyze_user_impact": {
          "type": "boolean",
          "description": "Include user impact assessment in issues",
          "default": true
        },
        "analyze_business_value": {
          "type": "boolean",
          "description": "Include business value scoring in issues",
          "default": true
        },
        "goals_discovery": {
          "type": "object",
          "description": "Settings for auto-discovering product goals from documentation",
          "properties": {
            "max_files": {
              "type": "integer",
              "description": "Maximum markdown files to analyze for goal discovery",
              "default": 5,
              "minimum": 1,
              "maximum": 20
            },
            "required_files": {
              "type": "array",
              "description": "Files that must exist for discovery (warning if missing)",
              "items": {"type": "string"},
              "default": ["README.md"]
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "sprints": {
      "type": "object",
      "description": "Sprint management settings",
      "properties": {
        "sprints_dir": {
          "type": "string",
          "description": "Directory for sprint definitions",
          "default": ".sprints"
        },
        "default_timeout": {
          "type": "integer",
          "description": "Default timeout per issue in seconds",
          "default": 3600,
          "minimum": 60
        },
        "default_max_workers": {
          "type": "integer",
          "description": "Default worker count for parallel execution within waves",
          "default": 4,
          "minimum": 1,
          "maximum": 8
        }
      },
      "additionalProperties": false
    },
    "sync": {
      "type": "object",
      "description": "GitHub Issues synchronization settings (opt-in feature, disabled by default)",
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Enable GitHub Issues sync feature",
          "default": false
        },
        "provider": {
          "type": "string",
          "enum": ["github"],
          "description": "Issue tracking provider (currently only GitHub supported)",
          "default": "github"
        },
        "github": {
          "type": "object",
          "description": "GitHub-specific sync settings",
          "properties": {
            "repo": {
              "type": ["string", "null"],
              "description": "GitHub repository (owner/repo format, auto-detected if null)",
              "default": null
            },
            "label_mapping": {
              "type": "object",
              "description": "Map issue types to GitHub labels",
              "additionalProperties": { "type": "string" },
              "default": {
                "BUG": "bug",
                "FEAT": "enhancement",
                "ENH": "enhancement"
              }
            },
            "priority_labels": {
              "type": "boolean",
              "description": "Add priority as GitHub label (e.g., 'P1')",
              "default": true
            },
            "sync_completed": {
              "type": "boolean",
              "description": "Also sync completed issues (close on GitHub)",
              "default": false
            },
            "state_file": {
              "type": "string",
              "description": "File to track sync state",
              "default": ".claude/ll-sync-state.json"
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": false
}
